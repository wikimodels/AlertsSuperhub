<div class="layout-container">

  <div class="coins-header">
    <app-search-filter (searchChange)="onFilterChange($event)"></app-search-filter>

    <h2 class="header-title">
      Working Line Alerts
      <!-- @if (alertsCount() > 0) {
      <span>({{ alertsCount() }})</span>
      } -->
    </h2>

    <app-alerts-panel-buttons [type]="'line'" [status]="'working'" [data]="dataSource.data"
      (refreshClicked)="loadAlerts()" (dataChanged)="loadAlerts()">
    </app-alerts-panel-buttons>
  </div>

  @if (isLoading()) {
  <div class="loading-overlay">
    <app-loading-spinner></app-loading-spinner>
  </div>
  } @else {

  <div class="table-wrapper" [appScrollReset]="dataSource.data">

    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0 alerts-table">

      <ng-container matColumnDef="symbol">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-target"> SYMBOL </th>
        <td mat-cell *matCellDef="let alert" class="col-symbol">
          <span class="symbol-text">{{ alert.symbol }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="alertName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-target"> ALERT NAME </th>
        <td mat-cell *matCellDef="let alert" class="col-target clickable-name" [appCopyPrice]="alert.price">
          {{ alert.alertName }}
        </td>
      </ng-container>

      <ng-container matColumnDef="isActive">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-target"
          style="text-align: center; padding: 0;">
          ACTIVE
        </th>
        <td mat-cell *matCellDef="let alert" class="col-target">
          <mat-slide-toggle [checked]="alert.isActive" color="primary" (click)="$event.stopPropagation()"
            (change)="toggleActiveState(alert, $event)">
          </mat-slide-toggle>
        </td>
      </ng-container>

      <ng-container matColumnDef="links">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-target"> LINKS </th>
        <td mat-cell *matCellDef="let alert" class="col-target">
          <div class="links-pill">
            <app-links [linkableObject]="alert"></app-links>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="col-target"> ACTIONS </th>
        <td mat-cell *matCellDef="let alert" class="col-target">
          <div class="links-pill">
            <app-chart-actions [linkableObject]="alert" [status]="'working'"
              (alertUpdated)="loadAlerts()"></app-chart-actions>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="checkbox">
        <th mat-header-cell *matHeaderCellDef class="col-actions">
        </th>
        <td mat-cell *matCellDef="let alert" class="col-actions">
          <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selectionService.toggle(alert) : null"
            [checked]="selectionService.isSelected(alert)">
          </mat-checkbox>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell empty-cell" colspan="6">No data matching the filter</td>
      </tr>
    </table>
  </div>

  <div class="pagination-footer">
    <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" [pageSize]="10" showFirstLastButtons
      aria-label="Select page of alerts">
    </mat-paginator>
  </div>

  }
</div>